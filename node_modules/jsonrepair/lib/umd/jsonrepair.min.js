((t,e)=>{"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).JSONRepair={})})(this,function(t){class y extends Error{constructor(t,e){super("".concat(t," at position ").concat(e)),this.position=e}}let d=125,e=32,O=10,N=9,J=13,S=8,j=12,k=34,r=39,m=48,z=57,l=44,I=65,T=97,Z=70,_=102,s=160,A=8192,E=8202,R=8239,X=8287,Y=12288,n=8220,o=8221,c=8216,i=8217,a=96,f=180;function U(t){return t>=m&&t<=z}function F(t){return h.test(t)}let h=/^[,:[\]/{}()\n+]$/,u=/^[,[\]/{}\n+]$/,tt=/^[a-zA-Z_$]$/,et=/^[a-zA-Z_$0-9]$/,q=/^(http|https|ftp|mailto|file|data|irc):\/\/$/,B=/^[A-Za-z0-9-._~:/?#@!$&'()*+;=]$/;function D(t){return u.test(t)}function G(t){return C.test(t)||t&&K(t.charCodeAt(0))}let C=/^[[{\w-]$/;function H(t){return t===e||t===O||t===N||t===J}function rt(t){return t===e||t===N||t===J}function K(t){return L(t)||P(t)}function L(t){return t===k||t===n||t===o}function M(t){return t===k}function P(t){return t===r||t===c||t===i||t===a||t===f}function Q(t){return t===r}function V(t,e,r){r=2<arguments.length&&void 0!==r&&r,e=t.lastIndexOf(e);return-1!==e?t.substring(0,e)+(r?"":t.substring(e+1)):t}function W(t,e){let r=t.length;if(!H(t.charCodeAt(r-1)))return t+e;for(;H(t.charCodeAt(r-1));)r--;return t.substring(0,r)+e+t.substring(r)}let nt={"\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","\t":"\\t"},ot={'"':'"',"\\":"\\","/":"/",b:"\b",f:"\f",n:"\n",r:"\r",t:"\t"};t.JSONRepairError=y,t.jsonrepair=function(C){let g=0,v="";if(!c())throw new y("Unexpected end of json string",C.length);var t=i(l);if(t&&b(),G(C[g])&&/[,\n][ \t\r]*$/.test(v)){t||(v=W(v,","));{let t=!0,e=!0;for(;e;)t?t=!1:i(l)||(v=W(v,",")),e=c();e||(v=V(v,",")),v="[\n".concat(v,"\n]")}}else t&&(v=V(v,","));for(;C.charCodeAt(g)===d||93===C.charCodeAt(g);)g++,b();if(g>=C.length)return v;throw new y("Unexpected character ".concat(JSON.stringify(C[g])),g);function c(){b();var t=(()=>{if(123!==C.charCodeAt(g))return!1;{v+="{",g++,b(),p(l)&&b();let e=!0;for(;g<C.length&&C.charCodeAt(g)!==d;){let t;if(e?(t=!0,e=!1):((t=i(l))||(v=W(v,",")),b()),a(),!(w()||f(!0))){C.charCodeAt(g)===d||123===C.charCodeAt(g)||93===C.charCodeAt(g)||91===C.charCodeAt(g)||void 0===C[g]?v=V(v,","):(()=>{throw new y("Object key expected",g)})();break}b();var r=i(58),n=g>=C.length,o=(r||(G(C[g])||n?v=W(v,":"):u()),c());o||(r||n?v+="null":u())}return C.charCodeAt(g)===d?(v+="}",g++):v=W(v,"}"),!0}})()||(()=>{if(91!==C.charCodeAt(g))return!1;{v+="[",g++,b(),p(l)&&b();let t=!0;for(;g<C.length&&93!==C.charCodeAt(g);){t?t=!1:i(l)||(v=W(v,",")),a();var e=c();if(!e){v=V(v,",");break}}return 93===C.charCodeAt(g)?(v+="]",g++):v=W(v,"]"),!0}})()||w()||(()=>{var t,e,r=g;if(45===C.charCodeAt(g)){if(g++,o())return h(r),!0;if(!U(C.charCodeAt(g)))return g=r,!1}for(;U(C.charCodeAt(g));)g++;if(46===C.charCodeAt(g)){if(g++,o())return h(r),!0;if(!U(C.charCodeAt(g)))return g=r,!1;for(;U(C.charCodeAt(g));)g++}if(101===C.charCodeAt(g)||69===C.charCodeAt(g)){if(g++,45!==C.charCodeAt(g)&&43!==C.charCodeAt(g)||g++,o())return h(r),!0;if(!U(C.charCodeAt(g)))return g=r,!1;for(;U(C.charCodeAt(g));)g++}if(o()){if(g>r)return t=C.slice(r,g),e=/^0\d/.test(t),v+=e?'"'.concat(t,'"'):t,!0}else g=r;return!1})()||e("true","true")||e("false","false")||e("null","null")||e("True","true")||e("False","false")||e("None","null")||f(!1)||(()=>{if("/"===C[g]){var t=g;for(g++;g<C.length&&("/"!==C[g]||"\\"===C[g-1]);)g++;return g++,v+='"'.concat(C.substring(t,g),'"'),!0}})();return b(),t}function b(t){var e=!(0<arguments.length&&void 0!==t)||t;g;let r=n(e);for(;r=(r=(()=>{if(47===C.charCodeAt(g)&&42===C.charCodeAt(g+1)){for(;g<C.length&&!((t,e)=>"*"===t[e]&&"/"===t[e+1])(C,g);)g++;g+=2}else{if(47!==C.charCodeAt(g)||47!==C.charCodeAt(g+1))return!1;for(;g<C.length&&C.charCodeAt(g)!==O;)g++}return!0})())&&n(e););g}function n(t){var e=t?H:rt;let r="";for(;;){var n=C.charCodeAt(g);if(e(n))r+=C[g];else{if(!((n=n)===s||n>=A&&n<=E||n===R||n===X||n===Y))break;r+=" "}g++}return 0<r.length&&(v+=r,!0)}function i(t){return C.charCodeAt(g)===t&&(v+=C[g],g++,!0)}function p(t){return C.charCodeAt(g)===t&&(g++,!0)}function a(){b(),46===C.charCodeAt(g)&&46===C.charCodeAt(g+1)&&46===C.charCodeAt(g+2)&&(g+=3,b(),p(l))}function w(t,e){var r,n,o=0<arguments.length&&void 0!==t&&t,c=1<arguments.length&&void 0!==e?e:-1;let i=92===C.charCodeAt(g);if(i&&(g++,i=!0),K(C.charCodeAt(g))){var a=M(C.charCodeAt(g))?M:Q(C.charCodeAt(g))?Q:P(C.charCodeAt(g))?P:L,f=g,h=v.length;let e='"';for(g++;;){if(g>=C.length)return u=x(g-1),!o&&F(C.charAt(u))?(g=f,v=v.substring(0,h),w(!0)):(e=W(e,'"'),v+=e,!0);if(g===c)return e=W(e,'"'),v+=e,!0;if(a(C.charCodeAt(g))){var u=g,d=e.length;if(e+='"',g++,v+=e,b(!1),o||g>=C.length||F(C.charAt(g))||K(C.charCodeAt(g))||U(C.charCodeAt(g)))return $(),!0;var l=x(u-1),s=C.charAt(l);if(","===s)return g=f,v=v.substring(0,h),w(!1,l);if(F(s))return g=f,v=v.substring(0,h),w(!0);v=v.substring(0,h),g=u+1,e="".concat(e.substring(0,d),"\\").concat(e.substring(d))}else{if(o&&D(C[g])){if(58===C.charCodeAt(g-1)&&q.test(C.substring(f+1,g+2)))for(;g<C.length&&B.test(C[g]);)e+=C[g],g++;return e=W(e,'"'),v+=e,$(),!0}if(92===C.charCodeAt(g)){l=C.charAt(g+1);if(void 0!==ot[l])e+=C.slice(g,g+2),g+=2;else if("u"===l){let t=2;for(;t<6&&((n=C.charCodeAt(g+t))>=m&&n<=z||n>=I&&n<=Z||n>=T&&n<=_);)t++;if(6===t)e+=C.slice(g,g+6),g+=6;else{if(!(g+t>=C.length))throw s=void 0,s=C.slice(g,g+6),new y('Invalid unicode character "'.concat(s,'"'),g);g=C.length}}else e+=l,g+=2}else{var d=C.charAt(g),A=C.charCodeAt(g);if(A===k&&92!==C.charCodeAt(g-1))e+="\\".concat(d);else if((r=A)===O||r===J||r===N||r===S||r===j)e+=nt[d];else{if(!(32<=(r=A)&&r<=1114111))throw A=void 0,A=d,new y("Invalid character ".concat(JSON.stringify(A)),g);e+=d}g++}}i&&p(92)}}return!1}function $(){let t=!1;for(b();43===C.charCodeAt(g);){t=!0,g++,b();var e=(v=V(v,'"',!0)).length,r=w();v=r?(r=v,e=e,n=1,r.substring(0,e)+r.substring(e+n)):W(v,'"')}var n;t}function e(t,e){return C.slice(g,g+t.length)===t&&(v+=e,g+=t.length,!0)}function f(t){var e=g;if(tt.test(C[g])){for(;g<C.length&&et.test(C[g]);)g++;let t=g;for(;H(C.charCodeAt(t));)t++;if("("===C[t])return g=t+1,c(),41===C.charCodeAt(g)&&(g++,59===C.charCodeAt(g))&&g++,!0}for(;g<C.length&&!D(C[g])&&!K(C.charCodeAt(g))&&(!t||58!==C.charCodeAt(g));)g++;if(58===C.charCodeAt(g-1)&&q.test(C.substring(e,g+2)))for(;g<C.length&&B.test(C[g]);)g++;if(g>e){for(;H(C.charCodeAt(g-1))&&0<g;)g--;e=C.slice(e,g);return v+="undefined"===e?"null":JSON.stringify(e),C.charCodeAt(g)===k&&g++,!0}}function x(t){let e=t;for(;0<e&&H(C.charCodeAt(e));)e--;return e}function o(){return g>=C.length||F(C[g])||H(C.charCodeAt(g))}function h(t){v+="".concat(C.slice(t,g),"0")}function u(){throw new y("Colon expected",g)}}});